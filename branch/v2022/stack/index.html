<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Efficient array computing &mdash; HPDA-Python  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script src="../_static/tabs.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Parallel computing" href="../parallel-computing/" />
    <link rel="prev" title="Scientific data" href="../scientific-data/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            HPDA-Python
              <img src="../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Installation and HPC access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scientific-data/">Scientific data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Efficient array computing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-can-python-be-slow">Why can Python be slow?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-typing">Dynamic typing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flexible-data-structures">Flexible data structures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numpy">NumPy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arrays">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-types">Data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-numpy-arrays">Creating NumPy arrays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#helper-functions">Helper functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#array-operations-and-manipulations">Array Operations and Manipulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#array-indexing">Array Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#array-aggregation">Array Aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#array-reshaping">Array Reshaping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#views-and-copies-of-arrays">Views and copies of arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-with-numpy">I/O with NumPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#random-numbers">Random numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#polynomials">Polynomials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linear-algebra">Linear algebra</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pandas">Pandas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tidy-vs-untidy-data">Tidy vs untidy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-analysis-workflow">Data analysis workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexing">Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#missing-invalid-data">Missing/invalid data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#groupby">Groupby</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scipy">Scipy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-s-in-scipy">What’s in SciPy?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parallel-computing/">Parallel computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimization/">Profiling and optimising</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance-boosting/">Performance boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dask/">Dask for scalable analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GPU-computing/">GPU computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional material</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pandas-extra/">Optional: more on Pandas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">HPDA-Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Efficient array computing</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/HPDA-Python/blob/main/content/stack.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="efficient-array-computing">
<span id="stack"></span><h1>Efficient array computing<a class="headerlink" href="#efficient-array-computing" title="Permalink to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand limitations of Python’s standard library for large data processing</p></li>
<li><p>Understand the logic behind NumPy ndarrays and learn to use some NumPy numerical computing tools</p></li>
<li><p>Learn to use data structures and analysis tools from Pandas</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>30 min teaching/type-along</p></li>
<li><p>20 min exercises</p></li>
</ul>
</div>
<p>This episode is partly based on material from this
<a class="reference external" href="https://github.com/csc-training/hpc-python">repository on HPC-Python from CSC</a> and
this <a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/">Python for Scientific Computing lesson</a>,
distributed under MIT and CC-BY-4.0 licenses, respectively.</p>
<section id="why-can-python-be-slow">
<h2>Why can Python be slow?<a class="headerlink" href="#why-can-python-be-slow" title="Permalink to this heading"></a></h2>
<p>Computer programs are nowadays practically always written in a high-level
human readable programming language and then translated to the actual machine
instructions that a processor understands. There are two main approaches for
this translation:</p>
<blockquote>
<div><ul class="simple">
<li><p>For <strong>compiled</strong> programming languages, the translation is done by
a compiler before the execution of the program</p></li>
<li><p>For <strong>interpreted</strong> languages, the translation is done by an interpreter
during the execution of the program</p></li>
</ul>
</div></blockquote>
<p>Compiled languages are typically more efficient, but the behaviour of
the program during runtime is more static than with interpreted languages.
The compilation step can also be time consuming, so the software cannot
always be tested as rapidly during development as with interpreted
languages.</p>
<p>Python is an interpreted language, and many features that make development
rapid with Python are a result of that, with the price of reduced performance
in many cases.</p>
<section id="dynamic-typing">
<h3>Dynamic typing<a class="headerlink" href="#dynamic-typing" title="Permalink to this heading"></a></h3>
<p>Python is a <em>dynamic</em> language. Variables get a type only during the
runtime when values (Python objects) are assigned to them, so it is more difficult
for the interpreter to optimize the execution. In comparison, a compiler can
make extensive analysis and optimization before the execution. Even though there has
in recent years been a lot of progress in just-in-time (JIT)
compilation techniques that allow programs to be optimized at runtime, the
inherent, dynamic nature of the Python programming language remains one
of its main performance bottlenecks.</p>
</section>
<section id="flexible-data-structures">
<h3>Flexible data structures<a class="headerlink" href="#flexible-data-structures" title="Permalink to this heading"></a></h3>
<p>The built-in data structures of Python, such as lists and dictionaries,
are very flexible, but they are also very generic which makes them not
well suited for extensive numerical computations. Even though the implementation
of data structures is often quite efficient when processing
different types of data, there is a lot of overhead due to the
generic nature of these data structures when processing only a single type of data.</p>
<p>In summary, the flexibility and dynamic nature of Python, which enhances
programmer productivity greatly, is also the main cause for the
performance problems. Fortunately, as we
discuss in the course, many of the bottlenecks can be circumvented.</p>
</section>
</section>
<section id="numpy">
<h2>NumPy<a class="headerlink" href="#numpy" title="Permalink to this heading"></a></h2>
<p>As probably the most fundamental building block of the scientific computing ecosystem in Python,
NumPy offers comprehensive mathematical functions, random number generators,
linear algebra routines, Fourier transforms, and more.</p>
<p>NumPy is based on well-optimized C code, which gives much better performace than regular Python.
In particular, by using homogeneous
data structures, NumPy <em>vectorizes</em> mathematical operations where fast pre-compiled code
can be applied to a sequence of data instead of using traditional <code class="docutils literal notranslate"><span class="pre">for</span></code> loops.</p>
<section id="arrays">
<h3>Arrays<a class="headerlink" href="#arrays" title="Permalink to this heading"></a></h3>
<p>The core of NumPy is the NumPy <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> (n-dimensional array). Compared to a Python list,
an ndarray is similar in terms of serving as a data container.
Some differences between the two are:</p>
<ul class="simple">
<li><p>ndarrays can have multiple dimensions, e.g. a 1-D array is a vector, a 2-D array is a matrix</p></li>
<li><p>ndarrays are fast only when all data elements are of the same type</p></li>
<li><p>ndarray operations are fast when vectorized</p></li>
<li><p>ndarrays are slower for certain operations, e.g. appending elements</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/list-vs-array.svg"><img alt="../_images/list-vs-array.svg" height="618" src="../_images/list-vs-array.svg" width="1339" /></a>
</figure>
</section>
<section id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Permalink to this heading"></a></h3>
<p>NumPy supports a much greater variety of numerical types (<code class="docutils literal notranslate"><span class="pre">dtype</span></code>) than Python does.
There are 5 basic numerical types representing booleans (<code class="docutils literal notranslate"><span class="pre">bool</span></code>), integers (<code class="docutils literal notranslate"><span class="pre">int</span></code>),
unsigned integers (<code class="docutils literal notranslate"><span class="pre">uint</span></code>) floating point (<code class="docutils literal notranslate"><span class="pre">float</span></code>) and complex (<code class="docutils literal notranslate"><span class="pre">complex</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># create float32 variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># array with uint8 unsigned integers</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="c1"># convert array to floats</span>
<span class="n">z</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-numpy-arrays">
<h3>Creating NumPy arrays<a class="headerlink" href="#creating-numpy-arrays" title="Permalink to this heading"></a></h3>
<p>One way to create a NumPy array is to convert from a Python list, but make sure that the list is homogeneous
(contains same data type) otherwise performace will be downgraded.
Since appending elements to an existing array is slow, it is a common practice to preallocate the necessary space
with <code class="docutils literal notranslate"><span class="pre">np.zeros</span></code> or <code class="docutils literal notranslate"><span class="pre">np.empty</span></code> when converting from a Python list is not possible.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">a</span>
<span class="c1"># array([ 1., 2., 3., 4.])</span>

<span class="n">list1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>
<span class="n">mat</span>
<span class="c1"># array([[ 1.+0.j, 2.+0.j, 3.+0.j],</span>
<span class="c1">#       [ 4.+0.j, 5.+0.j, 6.+0.j]])</span>

<span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># (2, 3)</span>

<span class="n">mat</span><span class="o">.</span><span class="n">size</span>
<span class="c1"># 6</span>
</pre></div>
</div>
<section id="helper-functions">
<h4>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">arange</span></code> and <code class="docutils literal notranslate"><span class="pre">linspace</span></code> can generate ranges of numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">b</span>
<span class="c1"># array([0.1 , 0.12, 0.14, 0.16, 0.18])</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">c</span>
<span class="c1"># array([-4.5 , -2.25, 0. , 2.25, 4.5 ])</span>
</pre></div>
</div>
<p>Array with given shape initialized to <code class="docutils literal notranslate"><span class="pre">zeros</span></code>, <code class="docutils literal notranslate"><span class="pre">ones</span></code>, arbitrary value (<code class="docutils literal notranslate"><span class="pre">full</span></code>)
or unitialized (<code class="docutils literal notranslate"><span class="pre">empty</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># (4, 6)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">b</span>
<span class="c1"># array([[ 1., 1., 1., 1.],</span>
<span class="c1">#       [ 1., 1., 1., 1.]])</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mf">4.2</span><span class="p">)</span>
<span class="n">c</span>
<span class="c1"># array([[4.2, 4.2, 4.2],</span>
<span class="c1">#       [4.2, 4.2, 4.2]])</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># array([[0.00000000e+000, 1.03103236e-259],</span>
<span class="c1">#       [0.00000000e+000, 9.88131292e-324]])</span>
</pre></div>
</div>
<p>Similar arrays as an existing array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="array-operations-and-manipulations">
<h3>Array Operations and Manipulations<a class="headerlink" href="#array-operations-and-manipulations" title="Permalink to this heading"></a></h3>
<p>All the familiar arithmetic operators in NumPy are applied elementwise:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">1D</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">2D</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_add_1d_new.svg" src="../_images/np_add_1d_new.svg" /></figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">/</span><span class="n">b</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_div_1d_new.svg" src="../_images/np_div_1d_new.svg" /></figure>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>

<span class="n">a</span> <span class="o">+</span> <span class="n">b</span>                       <span class="c1"># array([[11, 12, 13],</span>
                            <span class="c1">#        [14, 15, 16]])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_add_2d.svg" src="../_images/np_add_2d.svg" /></figure>
</div></div>
</section>
<section id="array-indexing">
<h3>Array Indexing<a class="headerlink" href="#array-indexing" title="Permalink to this heading"></a></h3>
<p>Basic indexing is similar to Python lists.
Note that advanced indexing creates copies of arrays.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">1D</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">2D</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_ind_0.svg" src="../_images/np_ind_0.svg" /></figure>
<p><strong>Integer indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind_integer.svg" src="../_images/np_ind_integer.svg" /></figure>
<p><strong>Fancy indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind_fancy.svg" src="../_images/np_ind_fancy.svg" /></figure>
<p><strong>Boolean indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind_boolean.svg" src="../_images/np_ind_boolean.svg" /></figure>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_ind2d_data.svg" src="../_images/np_ind2d_data.svg" /></figure>
<p><strong>Integer indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind2d_integer.svg" src="../_images/np_ind2d_integer.svg" /></figure>
<p><strong>Fancy indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind2d_fancy.svg" src="../_images/np_ind2d_fancy.svg" /></figure>
<p><strong>Boolean indexing:</strong></p>
<figure class="align-default">
<img alt="../_images/np_ind2d_boolean.svg" src="../_images/np_ind2d_boolean.svg" /></figure>
</div></div>
</section>
<section id="array-aggregation">
<h3>Array Aggregation<a class="headerlink" href="#array-aggregation" title="Permalink to this heading"></a></h3>
<p>Apart from aggregating values, one can also aggregate across rows or columns by using the <code class="docutils literal notranslate"><span class="pre">axis</span></code> parameter:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_max_2d.svg" src="../_images/np_max_2d.svg" /></figure>
<figure class="align-default">
<img alt="../_images/np_sum_2d.svg" src="../_images/np_sum_2d.svg" /></figure>
<figure class="align-default">
<img alt="../_images/np_min_2d_ax0.svg" src="../_images/np_min_2d_ax0.svg" /></figure>
<figure class="align-default">
<img alt="../_images/np_min_2d_ax1.svg" src="../_images/np_min_2d_ax1.svg" /></figure>
</section>
<section id="array-reshaping">
<h3>Array Reshaping<a class="headerlink" href="#array-reshaping" title="Permalink to this heading"></a></h3>
<p>Sometimes, you need to change the dimension of an array.
One of the most common need is to transposing the matrix
during the dot product. Switching the dimensions of
a NumPy array is also quite common in more advanced cases.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_reshape0.svg" src="../_images/np_reshape0.svg" /></figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_reshape43.svg" src="../_images/np_reshape43.svg" /></figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/np_reshape34.svg" src="../_images/np_reshape34.svg" /></figure>
</section>
<section id="views-and-copies-of-arrays">
<h3>Views and copies of arrays<a class="headerlink" href="#views-and-copies-of-arrays" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Simple assignment creates <strong>references</strong> to arrays</p></li>
<li><p>Slicing creates <strong>views</strong> to the arrays</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">copy</span></code> for real copying of arrays</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>              <span class="c1"># reference, changing values in b changes a</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>       <span class="c1"># true copy</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>         <span class="c1"># view, changing c changes elements [1:4] of a</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># true copy of subarray</span>
</pre></div>
</div>
</section>
<section id="i-o-with-numpy">
<h3>I/O with NumPy<a class="headerlink" href="#i-o-with-numpy" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Numpy provides functions for reading data from file and for writing data
into the files</p></li>
<li><p>Simple text files</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.loadtxt()</span></code></p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.savetxt()</span></code></p></li>
<li><p>Data in regular column layout</p></li>
<li><p>Can deal with comments and different column delimiters</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="random-numbers">
<h3>Random numbers<a class="headerlink" href="#random-numbers" title="Permalink to this heading"></a></h3>
<ul>
<li><p>The module <code class="docutils literal notranslate"><span class="pre">numpy.random</span></code> provides several functions for constructing
random arrays</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">random()</span></code>: uniform random numbers</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">normal()</span></code>: normal distribution</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">choice()</span></code>: random sample from given array</p></li>
<li><p>…</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">rnd</span>
<span class="n">rnd</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># array([[ 0.02909142, 0.90848 ],</span>
<span class="c1">#       [ 0.9471314 , 0.31424393]])</span>

<span class="n">rnd</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># array([0, 1, 1, 2, 1, 1, 2, 0, 2, 3])</span>
</pre></div>
</div>
</section>
<section id="polynomials">
<h3>Polynomials<a class="headerlink" href="#polynomials" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Polynomial is defined by an array of coefficients p
<code class="docutils literal notranslate"><span class="pre">p(x,</span> <span class="pre">N)</span> <span class="pre">=</span> <span class="pre">p[0]</span> <span class="pre">x^{N-1}</span> <span class="pre">+</span> <span class="pre">p[1]</span> <span class="pre">x^{N-2}</span> <span class="pre">+</span> <span class="pre">...</span> <span class="pre">+</span> <span class="pre">p[N-1]</span></code></p></li>
<li><p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>Least square fitting: <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.polyfit()</span></code></p></li>
<li><p>Evaluating polynomials: <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.polyval()</span></code></p></li>
<li><p>Roots of polynomial: <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.roots()</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">rnd</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">p</span>
<span class="c1"># array([ 0.96869003, -0.01157275, 0.69352514])</span>
</pre></div>
</div>
</section>
<section id="linear-algebra">
<h3>Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>NumPy can calculate matrix and vector products efficiently: <code class="xref py py-meth docutils literal notranslate"><span class="pre">dot()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">vdot()</span></code>, …</p></li>
<li><p>Eigenproblems: <code class="xref py py-meth docutils literal notranslate"><span class="pre">linalg.eig()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">linalg.eigvals()</span></code>, …</p></li>
<li><p>Linear systems and matrix inversion: <code class="xref py py-meth docutils literal notranslate"><span class="pre">linalg.solve()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">linalg.inv()</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># solve C x = b</span>
<span class="c1"># array([ 0.04453441, 0.06882591])</span>
</pre></div>
</div>
<ul>
<li><p>Normally, NumPy utilises high performance libraries in linear algebra
operations</p></li>
<li><p>Example: matrix multiplication C = A * B matrix dimension 1000</p>
<blockquote>
<div><ul class="simple">
<li><p>pure python:           522.30 s</p></li>
<li><p>naive C:                 1.50 s</p></li>
<li><p>numpy.dot:               0.04 s</p></li>
<li><p>library call from C:     0.04 s</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="pandas">
<h2>Pandas<a class="headerlink" href="#pandas" title="Permalink to this heading"></a></h2>
<p>Pandas is a Python package that provides high-performance and easy to use
data structures and data analysis tools. Built on NumPy arrays, Pandas is
particularly well suited to analyze tabular and time series data.
Although NumPy could in principle deal with structured arrays
(arrays with mixed data types), it is not efficient.</p>
<p>The core data structures of Pandas are Series and Dataframes.</p>
<ul class="simple">
<li><p>A Pandas <strong>series</strong> is a one-dimensional NumPy array with an index
which we could use to access the data</p></li>
<li><p>A <strong>dataframe</strong> consist of a table of values with labels for each row and column.
A dataframe can combine multiple data types, such as numbers and text,
but the data in each column is of the same type.</p></li>
<li><p>Each column of a dataframe is a series object - a dataframe is thus a collection of series.</p></li>
</ul>
<img alt="../_images/01_table_dataframe.svg" src="../_images/01_table_dataframe.svg" /><section id="tidy-vs-untidy-data">
<h3>Tidy vs untidy data<a class="headerlink" href="#tidy-vs-untidy-data" title="Permalink to this heading"></a></h3>
<p>Let’s first look at the following two dataframes:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">Untidy data format</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">Tidy data format</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
      <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 1&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">240</span><span class="p">},</span>
      <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 2&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
      <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 3&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">360</span><span class="p">},</span>
   <span class="p">])</span>
<span class="n">runners</span>

<span class="c1"># returns:</span>

<span class="c1">#      Runner  400  800  1200  1500</span>
<span class="c1"># 0  Runner 1   64  128   192   240</span>
<span class="c1"># 1  Runner 2   80  160   240   300</span>
<span class="c1"># 2  Runner 3   96  192   288   360</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;melt&quot; the data (opposite of &quot;pivot&quot;)</span>
<span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">runners</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Runner&quot;</span><span class="p">,</span>
                  <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span>
                  <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span>
                  <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span>
                  <span class="p">)</span>
<span class="c1"># returns:</span>

<span class="c1">#       Runner distance  time</span>
<span class="c1"># 0   Runner 1      400    64</span>
<span class="c1"># 1   Runner 2      400    80</span>
<span class="c1"># 2   Runner 3      400    96</span>
<span class="c1"># 3   Runner 1      800   128</span>
<span class="c1"># 4   Runner 2      800   160</span>
<span class="c1"># 5   Runner 3      800   192</span>
<span class="c1"># 6   Runner 1     1200   192</span>
<span class="c1"># 7   Runner 2     1200   240</span>
<span class="c1"># 8   Runner 3     1200   288</span>
<span class="c1"># 9   Runner 1     1500   240</span>
<span class="c1"># 10  Runner 2     1500   300</span>
<span class="c1"># 11  Runner 3     1500   360</span>
</pre></div>
</div>
</div></div>
<p>Most tabular data is either in a tidy format or a untidy format
(some people refer them as the long format or the wide format).</p>
<ul class="simple">
<li><p>In untidy (wide) format, each row represents an observation
consisting of multiple variables and each variable has its own column.
This is intuitive and easy for us to understand
and  make comparisons across different variables, calculate statistics, etc.</p></li>
<li><p>In tidy (long) format , i.e. column-oriented format, each row represents
only one variable of the observation, and can be considered “computer readable”.</p></li>
</ul>
<p>When it comes to data analysis using Pandas, the tidy format is recommended:</p>
<ul class="simple">
<li><p>Each column can be stored as a vector and this not only saves memory
but also allows for vectorized calculations which are much faster.</p></li>
<li><p>It’s easier to filter, group, join and aggregate the data.</p></li>
</ul>
<p>The name “tidy data” comes from <a class="reference external" href="https://vita.had.co.nz/papers/tidy-data.pdf">Wickham’s paper (2014)</a>
which describes the ideas in great detail.
This image from Hadley Wickham’s book <em>R for Data Science</em> visualizes the idea:</p>
<figure class="align-default">
<img alt="../_images/tidy_data.png" src="../_images/tidy_data.png" />
</figure>
</section>
<section id="data-analysis-workflow">
<h3>Data analysis workflow<a class="headerlink" href="#data-analysis-workflow" title="Permalink to this heading"></a></h3>
<p>Pandas is a powerful tool for many steps of a data analysis pipeline:</p>
<ul class="simple">
<li><p>Downloading and reading in datasets</p></li>
<li><p>Initial exploration of data</p></li>
<li><p>Pre-processing and cleaning data</p>
<ul>
<li><p>renaming, reshaping, reordering, type conversion, handling duplicate/missing/invalid data</p></li>
</ul>
</li>
<li><p>Analysis</p></li>
</ul>
<p>To explore some of the capabilities, we start with an
example dataset containing the passenger list from the Titanic, which is often used in
Kaggle competitions and data science tutorials. First step is to load Pandas and download
the dataset into a dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;</span>
<span class="c1"># set the index to the &quot;Name&quot; column</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas also understands multiple other formats, for example <code class="xref py py-meth docutils literal notranslate"><span class="pre">read_excel()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">read_hdf()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">read_json()</span></code>, etc. (and corresponding methods to write to file:
<code class="xref py py-meth docutils literal notranslate"><span class="pre">to_csv()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">to_excel()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">to_hdf()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">to_json()</span></code>, …)</p>
<p>We can now view the dataframe to get an idea of what it contains and
print some summary statistics of its numerical data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the first 5 lines of the dataframe</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># print some information about the columns</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="c1"># print summary statistics for each column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<p>Ok, so we have information on passenger names, survival (0 or 1), age,
ticket fare, number of siblings/spouses, etc. With the summary statistics we
see that the average age is 29.7 years, maximum ticket price is 512 USD,
38% of passengers survived, etc.</p>
<p>Unlike a NumPy array, a dataframe can combine multiple data types, such as
numbers and text, but the data in each column is of the same type. So we say a
column is of type <code class="docutils literal notranslate"><span class="pre">int64</span></code> or of type <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
</section>
<section id="indexing">
<h3>Indexing<a class="headerlink" href="#indexing" title="Permalink to this heading"></a></h3>
<p>Let’s inspect one column of the dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">Age</span>          <span class="c1"># same as above</span>
</pre></div>
</div>
<p>The columns have names. Here’s how to get them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<p>However, the rows also have names! This is what Pandas calls the <strong>index</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
<p>We saw above how to select a single column, but there are many ways of
selecting (and setting) single or multiple rows, columns and elements. We can
refer to columns and rows either by number or by their name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Lam, Mr. Ali&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>          <span class="c1"># select single value by row and column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s2">&quot;Lam, Mr. Ali&quot;</span><span class="p">,</span><span class="s2">&quot;Survived&quot;</span><span class="p">:</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>  <span class="c1"># slice the dataframe by row and column *names*</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>                      <span class="c1"># same slice as above by row and column *numbers*</span>

<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;Lam, Mr. Ali&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>      <span class="c1"># set single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;Lam, Mr. Ali&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>           <span class="c1"># select single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;Lam, Mr. Ali&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>      <span class="c1"># set single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>                           <span class="c1"># select same value by row and column *number* (fast)</span>

<span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;somecolumns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;somevalue&quot;</span>       <span class="c1"># set a whole column</span>
</pre></div>
</div>
<p>Dataframes also support boolean indexing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">]</span>
<span class="c1"># &quot;.str&quot; creates a string object from a column</span>
<span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Margaret&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="missing-invalid-data">
<h3>Missing/invalid data<a class="headerlink" href="#missing-invalid-data" title="Permalink to this heading"></a></h3>
<p>What if your dataset has missing data? Pandas uses the value <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>
to represent missing data, and by default does not include it in any computations.
We can find missing values, drop them from our dataframe, replace them
with any value we like or do forward or backward filling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>                    <span class="c1"># returns boolean mask of NaN values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>                  <span class="c1"># drop missing values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>         <span class="c1"># or how=&quot;all&quot;</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabin&quot;</span><span class="p">])</span>  <span class="c1"># only drop NaNs from one column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                 <span class="c1"># replace NaNs with zero</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>    <span class="c1"># forward-fill NaNs</span>
</pre></div>
</div>
</section>
<section id="groupby">
<h3>Groupby<a class="headerlink" href="#groupby" title="Permalink to this heading"></a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">groupby()</span></code> is a powerful method which splits a dataframe and aggregates data
in groups. To see what’s possible, let’s
test the old saying “Women and children first”. We start by creating a new
column <code class="docutils literal notranslate"><span class="pre">Child</span></code> to indicate whether a passenger was a child or not, based on
the existing <code class="docutils literal notranslate"><span class="pre">Age</span></code> column. For this example, let’s assume that you are a
child when you are younger than 12 years:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Now we can test the saying by grouping the data on <code class="docutils literal notranslate"><span class="pre">Sex</span></code> and then creating
further sub-groups based on <code class="docutils literal notranslate"><span class="pre">Child</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span> <span class="s2">&quot;Child&quot;</span><span class="p">])[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we chose to summarize the data by its mean, but many other common
statistical functions are available as dataframe methods, like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">std()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">min()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">max()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">cumsum()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">median()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">skew()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code> etc.</p>
<p>In a similar vein, one can use the <code class="docutils literal notranslate"><span class="pre">by</span></code> parameter to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">hist()</span></code> histogram plotting
method to create subplots by groups:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
             <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>The workflow of <code class="xref py py-meth docutils literal notranslate"><span class="pre">groupby()</span></code> can be divided into three general steps:</p>
<ul class="simple">
<li><p>Splitting: Partition the data into different groups based on some criterion.</p></li>
<li><p>Applying: Do some caclulation within each group.
Different kinds of calulations might be aggregation, transformation, filtration.</p></li>
<li><p>Combining: Put the results back together into a single object.</p></li>
</ul>
<img alt="../_images/groupby.png" src="../_images/groupby.png" />
<p>(Image source from lecture Earth and Environmental Data Science <a class="reference external" href="https://earth-env-data-science.github.io/intro.html">https://earth-env-data-science.github.io/intro.html</a>)</p>
<p>For an overview of other data wrangling methods built into Pandas, have a look
at <a class="reference internal" href="../pandas-extra/"><span class="doc">Optional: more on Pandas</span></a>.</p>
</section>
</section>
<section id="scipy">
<h2>Scipy<a class="headerlink" href="#scipy" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">SciPy</a> is a library that builds
on top of NumPy. It contains a lot of interfaces to battle-tested numerical routines
written in Fortran or C, as well as Python implementations of many common algorithms.</p>
<section id="what-s-in-scipy">
<h3>What’s in SciPy?<a class="headerlink" href="#what-s-in-scipy" title="Permalink to this heading"></a></h3>
<p>Briefly, it contains functionality for</p>
<ul class="simple">
<li><p>Special functions (Bessel, Gamma, etc.)</p></li>
<li><p>Numerical integration</p></li>
<li><p>Optimization</p></li>
<li><p>Interpolation</p></li>
<li><p>Fast Fourier Transform (FFT)</p></li>
<li><p>Signal processing</p></li>
<li><p>Linear algebra (more complete than in NumPy)</p></li>
<li><p>Sparse matrices</p></li>
<li><p>Statistics</p></li>
<li><p>More I/O routine, e.g. Matrix Market format for sparse matrices,
MATLAB files (.mat), etc.</p></li>
</ul>
<p>Many of these are not written specifically for SciPy, but use
the best available open source C or Fortran libraries.  Thus, you get
the best of Python and the best of compiled languages.</p>
<p>Most functions are documented very well from a scientific
standpoint: you aren’t just using some unknown function, but have a
full scientific description and citation to the method and
implementation.</p>
<p>Let us look more closely into one out of the countless useful functions available
in SciPy. <code class="xref py py-meth docutils literal notranslate"><span class="pre">curve_fit()</span></code> is a non-linear least squares fitting function. NumPy
has least-squares fitting via the <code class="xref py py-meth docutils literal notranslate"><span class="pre">np.linalg.lstsq()</span></code> function, but we need to
go to SciPy to find non-linear curve fitting.
This example fits a power-law to a vector:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="k">def</span> <span class="nf">powerlaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="c1"># data</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9115</span><span class="p">,</span> <span class="mi">8368</span><span class="p">,</span> <span class="mi">7711</span><span class="p">,</span> <span class="mi">5480</span><span class="p">,</span> <span class="mi">3492</span><span class="p">,</span> <span class="mi">3376</span><span class="p">,</span> <span class="mi">2884</span><span class="p">,</span> <span class="mi">2792</span><span class="p">,</span> <span class="mi">2703</span><span class="p">,</span> <span class="mi">2701</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span>

<span class="c1"># initial guess for variables</span>
<span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># fit data</span>
<span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">,</span> <span class="n">xdata</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A =&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;+/-&quot;</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s =&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;+/-&quot;</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># optionally plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">powerlaw</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>In an exercise below, you will learn to perform an operation like curve fitting
on all rows of a pandas dataframe in an effective manner.</p>
</section>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading"></a></h2>
<div class="admonition-working-effectively-with-dataframes exercise important admonition" id="exercise-0">
<p class="admonition-title">Working effectively with dataframes</p>
<p>Recall the <code class="xref py py-meth docutils literal notranslate"><span class="pre">curve_fit()</span></code> method from SciPy discussed above, and imagine that we
want to fit powerlaws to every row in a large dataframe. How can this be done effectively?</p>
<p>First define the <code class="xref py py-meth docutils literal notranslate"><span class="pre">powerlaw()</span></code> function and another function for fitting a row of numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="k">def</span> <span class="nf">powerlaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">,</span> <span class="n">xdata</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Next load a dataset with multiple rows similar to the one used in the example above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ENCCS/HPDA-Python/main/content/data/results.csv&quot;</span><span class="p">)</span>
<span class="c1"># print first few rows</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now consider these four different ways of fitting a powerlaw to each row of the dataframe:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">Loop</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></button><button aria-controls="panel-3-3-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-3" name="3-3" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code> with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code></button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_indx</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-3" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-3" name="3-3" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># raw=True passes numpy ndarrays instead of series to fit_powerlaw</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>Which one do you think is most efficient? You can measure the execution time
by adding <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> to the first line of a Jupyter code cell. More on timing
and profiling in a later episode.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>The execution time drops as you go from the version in the left tab to the right tab:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">Loop</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></button><button aria-controls="panel-4-4-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-2" name="4-2" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></button><button aria-controls="panel-4-4-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-3" name="4-3" role="tab" tabindex="-1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code> with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code></button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
   <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_indx</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
   <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
   <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># 33.6 ms ± 682 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
   <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
   <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># 28.7 ms ± 947 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-2" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-2" name="4-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 26.1 ms ± 1.19 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-3" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-3" name="4-3" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 24 ms ± 1.27 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="admonition-further-analysis-of-the-titanic-passenger-list-dataset exercise important admonition" id="exercise-1">
<p class="admonition-title">Further analysis of the Titanic passenger list dataset</p>
<p>Consider the titanic dataset. If you haven’t done so already, load it into a dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Compute the mean age of the first 10 passengers by slicing and the <code class="docutils literal notranslate"><span class="pre">mean</span></code> method</p></li>
<li><p>Using boolean indexing, compute the survival rate
(mean of “Survived” values) among passengers over and under the average age.</p></li>
</ol>
<p>Now investigate the family size of the passengers (i.e. the “SibSp” column):</p>
<ol class="arabic simple">
<li><p>What different family sizes exist in the passenger list? Hint: try the <code class="xref py py-meth docutils literal notranslate"><span class="pre">unique()</span></code> method</p></li>
<li><p>What are the names of the people in the largest family group?</p></li>
<li><p>(Advanced) Create histograms showing the distribution of family sizes for
passengers split by the fare, i.e. one group of high-fare passengers (where
the fare is above average) and one for low-fare passengers
(Hint: instead of an existing column name, you can give a lambda function
as a parameter to <code class="docutils literal notranslate"><span class="pre">hist</span></code> to compute a value on the fly. For example
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">titanic[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;</span></code>).</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<ol class="arabic simple">
<li><p>Mean age of the first 10 passengers: <code class="docutils literal notranslate"><span class="pre">titanic.iloc[:10,:][&quot;Age&quot;].mean()</span></code>
or <code class="docutils literal notranslate"><span class="pre">titanic.iloc[:10,4].mean()</span></code> or
<code class="docutils literal notranslate"><span class="pre">titanic.loc[:&quot;Nasser,</span> <span class="pre">Mrs.</span> <span class="pre">Nicholas</span> <span class="pre">(Adele</span> <span class="pre">Achem)&quot;,</span> <span class="pre">&quot;Age&quot;].mean()</span></code>.</p></li>
<li><p>Survival rate among passengers over and under average age:
<code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;Age&quot;]</span> <span class="pre">&gt;</span> <span class="pre">titanic[&quot;Age&quot;].mean()][&quot;Survived&quot;].mean()</span></code> and
<code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;Age&quot;]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Age&quot;].mean()][&quot;Survived&quot;].mean()</span></code>.</p></li>
<li><p>Existing family sizes: <code class="docutils literal notranslate"><span class="pre">titanic[&quot;SibSp&quot;].unique()</span></code></p></li>
<li><p>Names of members of largest family(ies): <code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;SibSp&quot;]</span> <span class="pre">==</span> <span class="pre">8].index</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titanic.hist(&quot;SibSp&quot;,</span> <span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">titanic[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;,</span> <span class="pre">rwidth=0.9)</span></code></p></li>
</ol>
</div>
</div>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>NumPy <a class="reference external" href="https://numpy.org/doc/stable/">documentation</a></p></li>
<li><p>Pandas  <a class="reference external" href="https://pandas.pydata.org/getting_started.html">getting started guide</a></p></li>
<li><p>Pandas <a class="reference external" href="https://pandas.pydata.org/docs/">documentation</a> containing a user guide,
API reference and contribution guide.</p></li>
<li><p>Pandas <a class="reference external" href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">cheatsheet</a></p></li>
<li><p>Pandas <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/cookbook.html#cookbook">cookbook</a>.</p></li>
<li><p>Scipy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">documentation</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>NumPy provides a static array data structure, fast mathematical operations for
arrays and tools for linear algebra and random numbers</p></li>
<li><p>Pandas dataframes are a good data structure for tabular data</p></li>
<li><p>Dataframes allow both simple and advanced analysis in very compact form</p></li>
<li><p>SciPy contains a lot of interfaces to battle-tested numerical routines</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../scientific-data/" class="btn btn-neutral float-left" title="Scientific data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../parallel-computing/" class="btn btn-neutral float-right" title="Parallel computing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ENCCS and individual contributors..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>